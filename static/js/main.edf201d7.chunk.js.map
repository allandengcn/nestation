{"version":3,"sources":["widgets/Header.module.css","emulator/Screen.js","emulator/FrameTimer.js","emulator/Speakers.js","emulator/controllers/Controller.js","emulator/controllers/LocalController.js","locales/index.js","locales/strings.js","emulator/index.js","emulator/Emulator.js","widgets/BalloonMessage.js","widgets/Header.js","networking/transfer/Send.js","networking/transfer/Receive.js","networking/MasterSyncer.js","networking/SlaveSyncer.js","gui/InviteHeader.js","gui/JoinHeader.js","widgets/KeyBinding.js","gui/Settings.js","gui/Overlay.js","widgets/TVNoise.js","gui/helpers/index.js","gui/helpers/cleanQueryString.js","gui/helpers/ellipsize.js","widgets/Controls.js","widgets/SettingsButton.js","gui/PlayScreen.js","App.js","index.js","widgets/Controls.module.css","gui/PlayScreen.module.css","gui/Overlay.module.css","gui/Settings.module.css","widgets/BalloonMessage.module.css","events/bus.js","events/index.js","emulator/Screen.module.css","assets/halu.svg","widgets/SettingsButton.module.css","config.js"],"names":["module","exports","header","small","message","title","titleLogo","titleText","link","Screen","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","setBuffer","bind","assertThisInitialized","writeBuffer","_this2","react_default","a","createElement","className","styles","screen","width","height","ref","canvas","_initCanvas","buffer","y","x","i","buf32","imageData","data","set","buf8","context","putImageData","getContext","getImageData","fillStyle","fillRect","buf","ArrayBuffer","length","Uint8ClampedArray","Uint32Array","Component","FPS","FrameTimer","onFrame","fps","arguments","undefined","_run","_isRunning","_frameId","requestAnimationFrame","now","Date","elapsedTime","_lastTime","_interval","_fps","_startTime","cancelAnimationFrame","BUFFER_SIZE","Speakers","bufferSize","RingBuffer","writeSample","_onAudioProcess","audioCtx","window","AudioContext","scriptNode","createScriptProcessor","onaudioprocess","gainNode","createGain","gain","value","config","sound","connect","destination","bus","on","disconnect","close","catch","console","error","removeListener","sampleRate","left","right","size","deqN","enq","event","samples","outputBuffer","getChannelData","e","BITS","Controller","player","getNes","buttons","BUTTON_A","BUTTON_B","BUTTON_SELECT","BUTTON_START","BUTTON_UP","BUTTON_DOWN","BUTTON_LEFT","BUTTON_RIGHT","byte","sync","button","isPressed","nes","buttonDown","jsnes","buttonUp","source","LocalController","onStart","_onKeyDown","keyMap","key","immediateButtons","isMaster","_onKeyUp","_","clone","options","input","esm_get","prototype","addEventListener","removeEventListener","strings","buffering","connected","connecting","controls","copied","crtEffect","dragARomHere","enabled_false","enabled_true","errors","connectionFailed","invalidRom","serverIsDown","loading","pressStart","setDefaults","settings","shareThis","toPlayWithSomeone","waiting","Emulator","localController","onStartPressed","remoteController","Screen_Screen","_initialize","attach","nextProps","stop","frameTimer","start","speakers","frame","onError","detach","_this3","_this$props","rom","bytes","Buffer","from","toString","NES","onAudioSample","getSampleRate","syncer","loadROM","emulator","BalloonMessage","children","classNames","balloon","character","src","haluImage","alt","Header","state","isEmpty","BalloonMessage_BalloonMessage","href","target","rel","Send","channel","_sent","_total","byteLength","send","remaining","Math","min","chunk","slice","Receive","_received","_appendBuffer","buffer1","buffer2","tmp","Uint8Array","STATE","MasterSyncer","_reset","_onData","masterBufferLimit","_state","_blindFrames","emit","_runFrame","_transfer","run","initializeRom","_emulator","_buffer","shift","remoteButtons","syncAll","toByte","_start","push","EventEmitter","SlaveSyncer","_hasPressedStart","_config$buffering","minBufferSize","maxBufferSize","_isBuffering","_ifBuffering","localButtons","COPIED_MESSAGE_TIME","InviteHeader","token","isDown","_copyLink","preventDefault","navigator","clipboard","writeText","setState","setTimeout","needsRom","_this$state","Header_Header","concat","onClick","onSyncer","quickp2p","createChannel","JoinHeader","joinChannel","KeyBinding","_onAssign","isAssigning","onAssignCancel","onAssignStart","displayName","_this$props$verticalM","verticalMirror","type","style","transform","display","BUTTONS","name","Settings","mappingButton","_onClose","_onSetDefaults","reset","_notify","oldKey","findKey","it","newKey","save","closeButton","setDefaultsButton","soundOptions","map","checked","onChange","_update","bufferingOptions","crt","KeyBinding_KeyBinding","property","container","document","querySelector","classList","add","remove","forceUpdate","Overlay","isSettingsMenuOpen","isLoading","isVisible","overlay","show","loader","dark","Settings_Settings","react_loader_spinner_default","color","TVNoise","borderRadius","self","toggle","loop","ctx","w","h","idata","createImageData","buffer32","len","random","noise","helpers","cleanQueryString","url","location","replace","substring","indexOf","history","replaceState","ellipsize","string","limit","FRIENDLY_NAMES","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," ","Controls","upKey","_keyFor","isUpArrow","id","centered","controller","dpad","element","_format","toUpperCase","SettingsButton","_onClick","tabIndex","require","default","PlayScreen","_onSyncer","_loadRom","initializeEmulator","_onFileDrop","file","first","dataTransfer","files","reader","FileReader","onload","result","updateRom","readAsArrayBuffer","_ignore","stopPropagation","_onStartPressed","_onError","app","JoinHeader_JoinHeader","InviteHeader_InviteHeader","main","gameContainer","Overlay_Overlay","src_emulator","TVNoise_TVNoise","Controls_Controls","menu","SettingsButton_SettingsButton","callback","noop","setStore","SimpleStore","App","hash","startsWith","PlayScreen_PlayScreen","inviteToken","_listener","querystring","parse","search","PureComponent","ReactDOM","render","App_App","getElementById","__webpack_require__","p","Config","D_work_nestation_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","defaultOptions","load","localStorage","setItem","JSON","stringify","getItem","find","d","Delete","Enter","__webpack_exports__"],"mappings":"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","file":"static/js/main.edf201d7.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"Header_header__2EMbD\",\"small\":\"Header_small__hkeVD\",\"message\":\"Header_message__1lzcS\",\"title\":\"Header_title__27oyM\",\"titleLogo\":\"Header_titleLogo__22oCA\",\"titleText\":\"Header_titleText__QhSYZ\",\"link\":\"Header_link__1ZWOq\"};","import React, { Component } from \"react\";\nimport styles from \"./Screen.module.css\";\n\nconst SCREEN_WIDTH = 256;\nconst SCREEN_HEIGHT = 240;\nconst FULL_ALPHA = 0xff000000;\n\nexport default class Screen extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.setBuffer = this.setBuffer.bind(this);\n\t\tthis.writeBuffer = this.writeBuffer.bind(this);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<canvas\n\t\t\t\tclassName={styles.screen}\n\t\t\t\twidth={SCREEN_WIDTH}\n\t\t\t\theight={SCREEN_HEIGHT}\n\t\t\t\tref={(canvas) => {\n\t\t\t\t\tif (canvas) this._initCanvas(canvas);\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n\n\tsetBuffer(buffer) {\n\t\tfor (let y = 0; y < SCREEN_HEIGHT; ++y) {\n\t\t\tfor (let x = 0; x < SCREEN_WIDTH; ++x) {\n\t\t\t\tconst i = y * 256 + x;\n\t\t\t\t// Convert pixel from NES BGR to canvas ABGR\n\t\t\t\tthis.buf32[i] = FULL_ALPHA | buffer[i];\n\t\t\t}\n\t\t}\n\t}\n\n\twriteBuffer() {\n\t\tthis.imageData.data.set(this.buf8);\n\t\tthis.context.putImageData(this.imageData, 0, 0);\n\t}\n\n\t_initCanvas(canvas) {\n\t\tthis.context = canvas.getContext(\"2d\");\n\t\tthis.imageData = this.context.getImageData(\n\t\t\t0,\n\t\t\t0,\n\t\t\tSCREEN_WIDTH,\n\t\t\tSCREEN_HEIGHT\n\t\t);\n\n\t\t// Set alpha to opaque\n\t\tthis.context.fillStyle = \"black\";\n\t\tthis.context.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);\n\n\t\t// Buffer to write on next animation frame\n\t\tthis.buf = new ArrayBuffer(this.imageData.data.length);\n\n\t\t// Get the canvas buffer in 8bit and 32bit\n\t\tthis.buf8 = new Uint8ClampedArray(this.buf);\n\t\tthis.buf32 = new Uint32Array(this.buf);\n\n\t\t// Set alpha\n\t\tfor (let i = 0; i < this.buf32.length; ++i) {\n\t\t\tthis.buf32[i] = FULL_ALPHA;\n\t\t}\n\t}\n}\n","const FPS = 60.098;\n\nexport default class FrameTimer {\n\tconstructor(onFrame, fps = FPS) {\n\t\tthis.onFrame = onFrame;\n\n\t\tthis._fps = fps;\n\t\tthis._interval = 1000 / fps;\n\t\tthis._lastTime = Date.now();\n\t\tthis._startTime = this._lastTime;\n\t\tthis._isRunning = false;\n\t}\n\n\tstart() {\n\t\tthis._isRunning = true;\n\t\tthis._run();\n\t}\n\n\tstop() {\n\t\tthis._isRunning = false;\n\t\tcancelAnimationFrame(this._frameId);\n\t}\n\n\t_run = () => {\n\t\tif (!this._isRunning) return;\n\t\tthis._frameId = requestAnimationFrame(this._run);\n\n\t\tconst now = Date.now();\n\t\tconst elapsedTime = now - this._lastTime;\n\n\t\tif (elapsedTime > this._interval) {\n\t\t\tthis._lastTime = now - (elapsedTime % this._interval);\n\t\t\tthis.onFrame();\n\t\t}\n\t};\n}\n","import RingBuffer from \"ringbufferjs\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\n\r\nconst BUFFER_SIZE = 8192;\r\nconst DEFAULT_SAMPLE_RATE = 44100;\r\n\r\nexport default class Speakers {\r\n\tconstructor() {\r\n\t\tthis.bufferSize = BUFFER_SIZE;\r\n\t\tthis.buffer = new RingBuffer(this.bufferSize * 2);\r\n\r\n\t\tthis.writeSample = this.writeSample.bind(this);\r\n\t\tthis._onAudioProcess = this._onAudioProcess.bind(this);\r\n\t}\r\n\r\n\tstart() {\r\n\t\tif (this.audioCtx) return;\r\n\t\tif (!window.AudioContext) return; // (audio is not supported)\r\n\r\n\t\tthis.audioCtx = new window.AudioContext();\r\n\t\tthis.scriptNode = this.audioCtx.createScriptProcessor(1024, 0, 2);\r\n\t\tthis.scriptNode.onaudioprocess = this._onAudioProcess;\r\n\t\tthis.gainNode = this.audioCtx.createGain();\r\n\t\tthis.gainNode.gain.value = config.sound.gain;\r\n\t\tthis.gainNode.connect(this.audioCtx.destination);\r\n\t\tthis.scriptNode.connect(this.gainNode);\r\n\r\n\t\tbus.on(\r\n\t\t\t\"volume\",\r\n\t\t\t(gain) => this.gainNode && (this.gainNode.gain.value = gain)\r\n\t\t);\r\n\t}\r\n\r\n\tstop() {\r\n\t\tif (this.scriptNode) {\r\n\t\t\tthis.gainNode.disconnect(this.audioCtx.destination);\r\n\t\t\tthis.scriptNode.disconnect(this.gainNode);\r\n\t\t\tthis.scriptNode.onaudioprocess = null;\r\n\t\t\tthis.scriptNode = null;\r\n\t\t\tthis.gainNode = null;\r\n\t\t}\r\n\r\n\t\tif (this.audioCtx) {\r\n\t\t\tthis.audioCtx.close().catch(console.error);\r\n\t\t\tthis.audioCtx = null;\r\n\t\t}\r\n\r\n\t\tbus.removeListener(\"volume\");\r\n\t}\r\n\r\n\tgetSampleRate() {\r\n\t\tif (!window.AudioContext) return DEFAULT_SAMPLE_RATE;\r\n\r\n\t\tconst context = new window.AudioContext();\r\n\t\tconst sampleRate = context.sampleRate;\r\n\t\tcontext.close();\r\n\r\n\t\treturn sampleRate;\r\n\t}\r\n\r\n\twriteSample(left, right) {\r\n\t\tif (this.buffer.size() / 2 >= this.bufferSize) {\r\n\t\t\t// buffer overrun\r\n\t\t\tthis.buffer.deqN(this.bufferSize / 2);\r\n\t\t}\r\n\r\n\t\tthis.buffer.enq(left);\r\n\t\tthis.buffer.enq(right);\r\n\t}\r\n\r\n\t_onAudioProcess(event) {\r\n\t\tconst left = event.outputBuffer.getChannelData(0);\r\n\t\tconst right = event.outputBuffer.getChannelData(1);\r\n\t\tconst size = left.length;\r\n\r\n\t\tlet samples;\r\n\t\ttry {\r\n\t\t\tsamples = this.buffer.deqN(size * 2);\r\n\t\t} catch (e) {\r\n\t\t\t// buffer underrun (needed {size}, got {this.buffer.size() / 2})\r\n\t\t\t// ignore empty buffers... assume audio has just stopped\r\n\r\n\t\t\tfor (let i = 0; i < size; i++) {\r\n\t\t\t\tleft[i] = 0;\r\n\t\t\t\tright[i] = 0;\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < size; i++) {\r\n\t\t\tleft[i] = samples[i * 2];\r\n\t\t\tright[i] = samples[i * 2 + 1];\r\n\t\t}\r\n\t}\r\n}\r\n","import jsnes from \"jsnes\";\n\nconst BITS = [\n\t0b00000001,\n\t0b00000010,\n\t0b00000100,\n\t0b00001000,\n\t0b00010000,\n\t0b00100000,\n\t0b01000000,\n\t0b10000000\n];\n\nexport default class Controller {\n\tconstructor(player = 1, getNes) {\n\t\tthis.player = player;\n\t\tthis.getNes = getNes;\n\n\t\tthis.buttons = {\n\t\t\tBUTTON_A: false,\n\t\t\tBUTTON_B: false,\n\t\t\tBUTTON_SELECT: false,\n\t\t\tBUTTON_START: false,\n\t\t\tBUTTON_UP: false,\n\t\t\tBUTTON_DOWN: false,\n\t\t\tBUTTON_LEFT: false,\n\t\t\tBUTTON_RIGHT: false\n\t\t};\n\t}\n\n\tsyncAll(byte) {\n\t\tthis.sync(\"BUTTON_A\", !!(byte & BITS[0]));\n\t\tthis.sync(\"BUTTON_B\", !!(byte & BITS[1]));\n\t\tthis.sync(\"BUTTON_SELECT\", !!(byte & BITS[2]));\n\t\tthis.sync(\"BUTTON_START\", !!(byte & BITS[3]));\n\t\tthis.sync(\"BUTTON_UP\", !!(byte & BITS[4]));\n\t\tthis.sync(\"BUTTON_DOWN\", !!(byte & BITS[5]));\n\t\tthis.sync(\"BUTTON_LEFT\", !!(byte & BITS[6]));\n\t\tthis.sync(\"BUTTON_RIGHT\", !!(byte & BITS[7]));\n\t}\n\n\tsync(button, isPressed) {\n\t\tconst nes = this.getNes();\n\n\t\tif (!this.buttons[button] && isPressed) {\n\t\t\tthis.buttons[button] = true;\n\t\t\tnes.buttonDown(this.player, jsnes.Controller[button]);\n\t\t} else if (this.buttons[button] && !isPressed) {\n\t\t\tthis.buttons[button] = false;\n\t\t\tnes.buttonUp(this.player, jsnes.Controller[button]);\n\t\t}\n\t}\n\n\ttoByte(source = this.buttons) {\n\t\treturn (\n\t\t\t(source.BUTTON_A && BITS[0]) |\n\t\t\t(source.BUTTON_B && BITS[1]) |\n\t\t\t(source.BUTTON_SELECT && BITS[2]) |\n\t\t\t(source.BUTTON_START && BITS[3]) |\n\t\t\t(source.BUTTON_UP && BITS[4]) |\n\t\t\t(source.BUTTON_DOWN && BITS[5]) |\n\t\t\t(source.BUTTON_LEFT && BITS[6]) |\n\t\t\t(source.BUTTON_RIGHT && BITS[7])\n\t\t);\n\t}\n}\n","import Controller from \"./Controller\";\nimport config from \"../../config\";\nimport bus from \"../../events\";\nimport _ from \"lodash\";\n\nexport default class LocalController extends Controller {\n\tconstructor(player, getNes, onStart = () => {}) {\n\t\tsuper(player, getNes);\n\n\t\tthis.immediateButtons = _.clone(this.buttons);\n\t\tthis.onStart = onStart;\n\t\tthis.keyMap = config.options.input;\n\t}\n\n\ttoByte() {\n\t\treturn super.toByte(this.immediateButtons);\n\t}\n\n\tattach() {\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\n\t\twindow.addEventListener(\"keyup\", this._onKeyUp);\n\t\tbus.on(\"keymap-updated\", () => (this.keyMap = config.options.input));\n\t}\n\n\tdetach() {\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDown);\n\t\twindow.removeEventListener(\"keyup\", this._onKeyUp);\n\t\tbus.removeListener(\"keymap-updated\");\n\t}\n\n\t_onKeyDown = (e) => {\n\t\tconst button = this.keyMap[e.key];\n\t\tif (!button) return;\n\n\t\tif (button === \"BUTTON_START\") this.onStart();\n\t\tthis.immediateButtons[button] = true;\n\t\tif (this.isMaster) this.sync(button, true);\n\t};\n\n\t_onKeyUp = (e) => {\n\t\tconst button = this.keyMap[e.key];\n\t\tif (!button) return;\n\n\t\tthis.immediateButtons[button] = false;\n\t\tif (this.isMaster) this.sync(button, false);\n\t};\n\n\tget isMaster() {\n\t\treturn this.player === 1;\n\t}\n}\n","import strings from \"./strings\";\r\n\r\nexport default strings;\r\n","export default {\n\tbuffering: \"Buffering\",\n\tconnected: \"Connected!\",\n\tconnecting: \"Connecting...\",\n\tcontrols: \"-Controls-\",\n\tcopied: \"Copied!\",\n\tcrtEffect: \"CRT Effect\",\n\tdragARomHere: \"Drag a NES rom file here!\",\n\tenabled_false: \"Disabled\",\n\tenabled_true: \"Enabled\",\n\terrors: {\n\t\tconnectionFailed: \"CONNECTION FAILED :(\",\n\t\tinvalidRom: \"INVALID ROM :(\",\n\t\tserverIsDown: \"The server is down :(\"\n\t},\n\tinput: \"Input\",\n\tlink: \"link\",\n\tloading: \"Loading...\",\n\tpressStart: \"PRESS START\",\n\tsetDefaults: \"Set defaults\",\n\tsettings: \"Settings\",\n\tsound: \"Sound\",\n\tshareThis: \"Share this\",\n\ttoPlayWithSomeone: \"to play with someone!\",\n\twaiting: \"WAITING...\"\n};\n","import Emulator from \"./Emulator\";\r\n\r\nexport default Emulator;\r\n","import React, { Component } from \"react\";\r\nimport { Buffer } from \"buffer\";\r\nimport Screen from \"./Screen\";\r\nimport FrameTimer from \"./FrameTimer\";\r\nimport Speakers from \"./Speakers\";\r\nimport { Controller, LocalController } from \"./controllers\";\r\nimport strings from \"../locales\";\r\nimport jsnes, { NES } from \"jsnes\";\r\n\r\nexport default class Emulator extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tconst getNes = () => this.nes;\r\n\t\tthis.localController = new LocalController(1, getNes, props.onStartPressed);\r\n\t\tthis.remoteController = new Controller(2, getNes);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Screen\r\n\t\t\t\tref={(screen) => {\r\n\t\t\t\t\tif (screen) this._initialize(screen);\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.localController.attach();\r\n\t}\r\n\r\n\tcomponentWillUpdate(nextProps) {\r\n\t\tthis.stop();\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis.frameTimer.start();\r\n\t\tthis.speakers.start();\r\n\t}\r\n\r\n\tstop() {\r\n\t\tthis.frameTimer.stop();\r\n\t\tthis.speakers.stop();\r\n\t}\r\n\r\n\tframe() {\r\n\t\ttry {\r\n\t\t\tthis.nes.frame();\r\n\t\t\tthis.screen.writeBuffer();\r\n\t\t} catch (e) {\r\n\t\t\tthis.props.onError(strings.errors.invalidRom, false);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.stop();\r\n\t\tthis.localController.detach();\r\n\t}\r\n\r\n\t_initialize(screen) {\r\n\t\tconst { rom, onError } = this.props;\r\n\t\tif (!rom) return;\r\n\t\tconst bytes = Buffer.from(rom).toString(\"binary\");\r\n\r\n\t\tthis.screen = screen;\r\n\r\n\t\tthis.speakers = new Speakers();\r\n\r\n\t\tthis.nes = new NES({\r\n\t\t\tonFrame: this.screen.setBuffer,\r\n\t\t\tonAudioSample: this.speakers.writeSample,\r\n\t\t\tsampleRate: this.speakers.getSampleRate()\r\n\t\t});\r\n\r\n\t\tthis.frameTimer = new FrameTimer(() => {\r\n\t\t\tconst { syncer } = this.props;\r\n\r\n\t\t\tif (syncer) syncer.sync();\r\n\t\t\telse this.frame();\r\n\t\t});\r\n\r\n\t\t// Load ROM data as a string and start\r\n\t\ttry {\r\n\t\t\tthis.nes.loadROM(bytes);\r\n\t\t} catch (e) {\r\n\t\t\tonError(strings.errors.invalidRom, false);\r\n\t\t}\r\n\r\n\t\t// DEBUG\r\n\t\twindow.emulator = this;\r\n\t\twindow.jsnes = jsnes;\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\nimport styles from \"./BalloonMessage.module.css\";\nimport haluImage from \"../assets/halu.svg\";\nimport classNames from \"classnames\";\n\nexport default class BalloonMessage extends Component {\n\trender() {\n\t\tconst { children } = this.props;\n\n\t\treturn (\n\t\t\t<section className=\"message -left\">\n\t\t\t\t<div\n\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\tstyles.balloon,\n\t\t\t\t\t\t\"nes-balloon\",\n\t\t\t\t\t\t\"from-left\",\n\t\t\t\t\t\t\"is-small\"\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t<p>{children}</p>\n\t\t\t\t</div>\n\t\t\t\t<br />\n\t\t\t\t<img className={styles.character} src={haluImage} alt=\"character\" />\n\t\t\t</section>\n\t\t);\n\t}\n}\n","import React, { Component } from \"react\";\nimport BalloonMessage from \"./BalloonMessage\";\nimport styles from \"./Header.module.css\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\n\nexport default class Header extends Component {\n\tstate = { bytes: null };\n\n\trender() {\n\t\tconst { children } = this.props;\n\n\t\treturn (\n\t\t\t<div className={styles.header}>\n\t\t\t\t<div className={styles.small}>\n\t\t\t\t\t{!_.isEmpty(children) && (\n\t\t\t\t\t\t<BalloonMessage\n\t\t\t\t\t\t\tclassName={classNames(styles.message, styles.small)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{children}\n\t\t\t\t\t\t</BalloonMessage>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\n\t\t\t\t<h2 className={styles.title}>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<i className={classNames(styles.titleLogo, \"nes-logo\")} />\n\t\t\t\t\t\t<span className={styles.titleText}>NEStation</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"https://github.com/rodri042/nestation#nestation\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\t\tstyles.link,\n\t\t\t\t\t\t\t\t\tstyles.titleLogo,\n\t\t\t\t\t\t\t\t\t\"nes-octocat\"\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</h2>\n\t\t\t</div>\n\t\t);\n\t}\n}\n","const CHUNK_SIZE = 1024;\n\nexport default class Send {\n\tconstructor(rom, channel) {\n\t\tthis.rom = rom;\n\t\tthis.channel = channel;\n\n\t\tthis._sent = 0;\n\t\tthis._total = rom.byteLength;\n\t}\n\n\trun() {\n\t\tif (this._sent === this._total) {\n\t\t\tthis.channel.send(\"end\");\n\t\t\treturn true;\n\t\t}\n\n\t\tconst remaining = this._total - this._sent;\n\t\tconst size = Math.min(CHUNK_SIZE, remaining);\n\t\tconst chunk = this.rom.slice(this._sent, this._sent + size);\n\n\t\tthis._sent += size;\n\t\tthis.channel.send(chunk);\n\t}\n\n\tget transferred() {\n\t\treturn this._sent;\n\t}\n}\n","export default class Receive {\n\tconstructor(channel) {\n\t\tthis.rom = new ArrayBuffer();\n\t\tthis.channel = channel;\n\n\t\tthis._received = 0;\n\t}\n\n\trun(bytes) {\n\t\tthis.rom = this._appendBuffer(this.rom, bytes);\n\n\t\tthis._received += bytes.byteLength;\n\t\tthis.channel.send(\"next\");\n\t}\n\n\t_appendBuffer(buffer1, buffer2) {\n\t\tvar tmp = new Uint8Array(buffer1.byteLength + buffer2.byteLength);\n\t\ttmp.set(new Uint8Array(buffer1), 0);\n\t\ttmp.set(new Uint8Array(buffer2), buffer1.byteLength);\n\t\treturn tmp.buffer;\n\t}\n\n\tget transferred() {\n\t\treturn this._received;\n\t}\n}\n","import EventEmitter from \"eventemitter3\";\r\nimport { Send } from \"./transfer\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\nimport strings from \"../locales\";\r\n\r\nconst STATE = {\r\n\tSENDING_ROM: 0,\r\n\tPLAYING: 1\r\n};\r\n\r\nexport default class MasterSyncer extends EventEmitter {\r\n\tconstructor(channel) {\r\n\t\tsuper();\r\n\r\n\t\tthis.channel = channel;\r\n\t\tthis._reset();\r\n\t\tthis.channel.on(\"data\", (bytes) => this._onData(bytes));\r\n\t}\r\n\r\n\tsync() {\r\n\t\tconst { masterBufferLimit } = config.buffering;\r\n\r\n\t\tif (\r\n\t\t\tthis._state !== STATE.PLAYING ||\r\n\t\t\tthis._blindFrames > masterBufferLimit\r\n\t\t) {\r\n\t\t\tbus.emit(\"isLoading\", true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tbus.emit(\"isLoading\", false);\r\n\t\tthis._runFrame();\r\n\t}\r\n\r\n\tinitializeRom(rom) {\r\n\t\tthis._transfer = new Send(rom, this.channel);\r\n\t\tthis._transfer.run();\r\n\t\tthis.emit(\"rom\", rom);\r\n\t}\r\n\r\n\tupdateRom(rom) {\r\n\t\tthis.channel.send(\"new-rom\");\r\n\t\tthis._reset();\r\n\t\tthis.initializeRom(rom);\r\n\t}\r\n\r\n\tinitializeEmulator(emulator) {\r\n\t\tthis._emulator = emulator;\r\n\r\n\t\temulator.localController.player = 1;\r\n\t\temulator.remoteController.player = 2;\r\n\t}\r\n\r\n\tonStartPressed() {}\r\n\r\n\t_start() {\r\n\t\tthis._transfer = null;\r\n\t\tthis._state = STATE.PLAYING;\r\n\t\tthis.emit(\"start\");\r\n\t\tbus.emit(\"message\", null);\r\n\t\tbus.emit(\"isLoading\", false);\r\n\t}\r\n\r\n\t_runFrame() {\r\n\t\tconst { masterBufferLimit } = config.buffering;\r\n\r\n\t\t// buffer overrun\r\n\t\tif (this._buffer.length > masterBufferLimit) {\r\n\t\t\tfor (let i = 0; i < this._buffer.length - masterBufferLimit; i++)\r\n\t\t\t\tthis._buffer.shift();\r\n\t\t}\r\n\r\n\t\tconst bytes = this._buffer.shift();\r\n\t\tif (bytes) {\r\n\t\t\t// normal scenario\r\n\t\t\tconst remoteButtons = new Uint8Array(bytes)[0];\r\n\t\t\tthis._emulator.remoteController.syncAll(remoteButtons);\r\n\t\t} else {\r\n\t\t\t// buffer underrun, do nothing (assume previous input)\r\n\t\t}\r\n\r\n\t\tconst buffer = new Uint8Array(2);\r\n\t\tbuffer[0] = this._emulator.localController.toByte();\r\n\t\tbuffer[1] = this._emulator.remoteController.toByte();\r\n\t\tthis.channel.send(buffer);\r\n\t\tthis._blindFrames++;\r\n\r\n\t\tthis._emulator.frame();\r\n\t}\r\n\r\n\t_onData(bytes) {\r\n\t\tswitch (this._state) {\r\n\t\t\tcase STATE.SENDING_ROM:\r\n\t\t\t\tif (bytes === \"next\") {\r\n\t\t\t\t\tconst hasEnded = this._transfer.run();\r\n\t\t\t\t\tif (hasEnded) bus.emit(\"message\", strings.waiting);\r\n\t\t\t\t} else if (bytes === \"start\") this._start();\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase STATE.PLAYING:\r\n\t\t\t\tthis._buffer.push(bytes);\r\n\t\t\t\tthis._blindFrames = 0;\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t}\r\n\r\n\t_reset() {\r\n\t\tthis._state = STATE.SENDING_ROM;\r\n\t\tthis._transfer = null;\r\n\t\tthis._buffer = [];\r\n\t\tthis._blindFrames = 0;\r\n\r\n\t\tbus.emit(\"isLoading\", true);\r\n\t}\r\n}\r\n","import EventEmitter from \"eventemitter3\";\r\nimport { Receive } from \"./transfer\";\r\nimport config from \"../config\";\r\nimport bus from \"../events\";\r\nimport strings from \"../locales\";\r\n\r\nconst STATE = {\r\n\tRECEIVING_ROM: 0,\r\n\tWAITING_START: 1,\r\n\tPLAYING: 2\r\n};\r\n\r\nexport default class SlaveSyncer extends EventEmitter {\r\n\tconstructor(channel) {\r\n\t\tsuper();\r\n\r\n\t\tthis.channel = channel;\r\n\t\tthis._reset();\r\n\t\tthis.channel.on(\"data\", (bytes) => this._onData(bytes));\r\n\t\tthis._hasPressedStart = false;\r\n\t}\r\n\r\n\tsync() {\r\n\t\tconst { minBufferSize, maxBufferSize } = config.buffering;\r\n\r\n\t\t// buffer underrun\r\n\t\tif (this._buffer.length < minBufferSize) {\r\n\t\t\tthis._isBuffering = true;\r\n\t\t\tbus.emit(\"isLoading\", true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// buffer overrun\r\n\t\tif (this._buffer.length > maxBufferSize) {\r\n\t\t\tfor (let i = 0; i < this._buffer.length - maxBufferSize; i++)\r\n\t\t\t\tthis._runFrame();\r\n\t\t}\r\n\r\n\t\t// normal scenario\r\n\t\tif (this._isBuffering && this._buffer.length < maxBufferSize) return;\r\n\t\telse this._runFrame();\r\n\t}\r\n\r\n\tinitializeRom(rom) {}\r\n\r\n\tupdateRom(rom) {}\r\n\r\n\tinitializeEmulator(emulator) {\r\n\t\tthis._emulator = emulator;\r\n\r\n\t\tbus.emit(\"isLoading\", false);\r\n\t\temulator.localController.player = 2;\r\n\t\temulator.remoteController.player = 1;\r\n\t}\r\n\r\n\tonStartPressed() {\r\n\t\tif (this._state === STATE.WAITING_START) {\r\n\t\t\tthis._hasPressedStart = true;\r\n\t\t\tthis._start();\r\n\t\t}\r\n\t}\r\n\r\n\t_start() {\r\n\t\tthis.emit(\"start\");\r\n\t\tthis.channel.send(\"start\");\r\n\t\tbus.emit(\"message\", null);\r\n\t\tthis._state = STATE.PLAYING;\r\n\t}\r\n\r\n\t_runFrame() {\r\n\t\tthis._ifBuffering = false;\r\n\t\tbus.emit(\"isLoading\", false);\r\n\r\n\t\tconst bytes = this._buffer.shift();\r\n\t\tconst remoteButtons = new Uint8Array(bytes)[0];\r\n\t\tconst localButtons = new Uint8Array(bytes)[1];\r\n\t\tthis._emulator.remoteController.syncAll(remoteButtons);\r\n\t\tthis._emulator.localController.syncAll(localButtons);\r\n\r\n\t\tthis._emulator.frame();\r\n\t}\r\n\r\n\t_onData(bytes) {\r\n\t\tif (bytes === \"new-rom\") {\r\n\t\t\tthis._reset();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tswitch (this._state) {\r\n\t\t\tcase STATE.RECEIVING_ROM:\r\n\t\t\t\tif (bytes === \"end\") {\r\n\t\t\t\t\tthis.emit(\"rom\", this._transfer.rom);\r\n\t\t\t\t\tthis._transfer = null;\r\n\r\n\t\t\t\t\tif (this._hasPressedStart) this._start();\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tbus.emit(\"message\", strings.pressStart);\r\n\t\t\t\t\t\tthis._state = STATE.WAITING_START;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._transfer.run(bytes);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase STATE.PLAYING:\r\n\t\t\t\tif (!this._emulator) return;\r\n\r\n\t\t\t\tthis._buffer.push(bytes);\r\n\r\n\t\t\t\tconst buffer = new Uint8Array(1);\r\n\t\t\t\tbuffer[0] = this._emulator.localController.toByte();\r\n\t\t\t\tthis.channel.send(buffer);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t}\r\n\r\n\t_reset() {\r\n\t\tthis._state = STATE.RECEIVING_ROM;\r\n\t\tthis._transfer = new Receive(this.channel);\r\n\t\tthis._isBuffering = false;\r\n\t\tthis._buffer = [];\r\n\r\n\t\tbus.emit(\"isLoading\", true);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\nimport Header from \"../widgets/Header\";\nimport { MasterSyncer } from \"../networking\";\nimport quickp2p from \"quickp2p\";\nimport strings from \"../locales\";\n\nconst COPIED_MESSAGE_TIME = 1000;\n\nexport default class InviteHeader extends Component {\n\tstate = { token: null, copied: false, isDown: false };\n\n\trender() {\n\t\tconst { needsRom } = this.props;\n\t\tconst { token, copied, isDown } = this.state;\n\n\t\treturn (\n\t\t\t<Header>\n\t\t\t\t{copied ? (\n\t\t\t\t\t<span>{strings.copied}</span>\n\t\t\t\t) : needsRom ? (\n\t\t\t\t\t<span>{strings.dragARomHere}</span>\n\t\t\t\t) : token ? (\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{strings.shareThis}{\" \"}\n\t\t\t\t\t\t<a href={`?token=${token}#/join`} onClick={this._copyLink}>\n\t\t\t\t\t\t\t{strings.link}\n\t\t\t\t\t\t</a>{\" \"}\n\t\t\t\t\t\t{strings.toPlayWithSomeone}\n\t\t\t\t\t</span>\n\t\t\t\t) : isDown ? (\n\t\t\t\t\t<span>{strings.errors.serverIsDown}</span>\n\t\t\t\t) : (\n\t\t\t\t\t<span>{strings.loading}</span>\n\t\t\t\t)}\n\t\t\t</Header>\n\t\t);\n\t}\n\n\tasync componentDidUpdate(nextProps) {\n\t\tconst { needsRom, onSyncer, onError } = this.props;\n\t\tif (needsRom || this.channel) return;\n\n\t\ttry {\n\t\t\tthis.channel = await quickp2p.createChannel();\n\t\t\tthis.channel\n\t\t\t\t.on(\"connected\", () => {\n\t\t\t\t\tonSyncer(new MasterSyncer(this.channel));\n\t\t\t\t})\n\t\t\t\t.on(\"disconnected\", onError);\n\t\t\tthis.setState({ token: this.channel.token, isDown: false });\n\t\t} catch (e) {\n\t\t\tthis.setState({ isDown: true });\n\t\t}\n\t}\n\n\t_copyLink = (e) => {\n\t\te.preventDefault();\n\n\t\tnavigator.clipboard.writeText(e.target.href);\n\t\tthis.setState({ copied: true });\n\t\tsetTimeout(() => {\n\t\t\tthis.setState({ copied: false });\n\t\t}, COPIED_MESSAGE_TIME);\n\t};\n}\n","import React, { Component } from \"react\";\nimport Header from \"../widgets/Header\";\nimport { SlaveSyncer } from \"../networking\";\nimport quickp2p from \"quickp2p\";\nimport strings from \"../locales\";\n\nexport default class JoinHeader extends Component {\n\trender() {\n\t\treturn (\n\t\t\t<Header>\n\t\t\t\t<span>{strings.connecting}</span>\n\t\t\t</Header>\n\t\t);\n\t}\n\n\tasync componentDidMount() {\n\t\tconst { onSyncer, onError } = this.props;\n\n\t\ttry {\n\t\t\tconst channel = await quickp2p.joinChannel(this.props.token);\n\t\t\tchannel\n\t\t\t\t.on(\"connected\", () => {\n\t\t\t\t\tonSyncer(new SlaveSyncer(channel));\n\t\t\t\t})\n\t\t\t\t.on(\"disconnected\", onError);\n\t\t} catch (e) {\n\t\t\tonError();\n\t\t}\n\t}\n}\n","import React, { Component } from \"react\";\n\nexport default class KeyBinding extends Component {\n\trender() {\n\t\tconst { displayName, isAssigning, verticalMirror = false } = this.props;\n\n\t\treturn (\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclassName=\"nes-btn is-primary\"\n\t\t\t\tonClick={this._onAssign}\n\t\t\t>\n\t\t\t\t<span\n\t\t\t\t\tstyle={\n\t\t\t\t\t\tverticalMirror\n\t\t\t\t\t\t\t? { transform: \"scale(1, -1)\", display: \"inline-block\" }\n\t\t\t\t\t\t\t: null\n\t\t\t\t\t}\n\t\t\t\t>\n\t\t\t\t\t{isAssigning ? \"...\" : displayName}\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t);\n\t}\n\n\t_onAssign = () => {\n\t\tif (this.props.isAssigning) this.props.onAssignCancel();\n\t\telse this.props.onAssignStart();\n\t};\n}\n","import React, { Component } from \"react\";\nimport KeyBinding from \"../widgets/KeyBinding\";\nimport bus from \"../events\";\nimport config from \"../config\";\nimport strings from \"../locales\";\nimport styles from \"./Settings.module.css\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\n\nconst BUTTONS = [\n\t{ name: \"BUTTON_LEFT\", displayName: \"<\" },\n\t{ name: \"BUTTON_RIGHT\", displayName: \">\" },\n\t{ name: \"BUTTON_UP\", displayName: \"v\", verticalMirror: true },\n\t{ name: \"BUTTON_DOWN\", displayName: \"v\" },\n\t{ name: \"BUTTON_B\", displayName: \"B\" },\n\t{ name: \"BUTTON_A\", displayName: \"A\" },\n\t{ name: \"BUTTON_SELECT\", displayName: \"SELECT\" },\n\t{ name: \"BUTTON_START\", displayName: \"START\" }\n];\n\nexport default class Settings extends Component {\n\tstate = { mappingButton: null };\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDown);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div className={styles.settings}>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclassName={classNames(styles.closeButton, \"nes-btn\", \"is-error\")}\n\t\t\t\t\tonClick={this._onClose}\n\t\t\t\t>\n\t\t\t\t\tx\n\t\t\t\t</button>\n\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\tstyles.setDefaultsButton,\n\t\t\t\t\t\t\"nes-btn\",\n\t\t\t\t\t\t\"is-warning\"\n\t\t\t\t\t)}\n\t\t\t\t\tonClick={this._onSetDefaults}\n\t\t\t\t>\n\t\t\t\t\t{strings.setDefaults}\n\t\t\t\t</button>\n\n\t\t\t\t<section\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"title\">{strings.sound}</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{config.soundOptions.map((it) => (\n\t\t\t\t\t\t\t<label key={it.name}>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\n\t\t\t\t\t\t\t\t\tname=\"sound\"\n\t\t\t\t\t\t\t\t\tchecked={config.options.sound === it.name}\n\t\t\t\t\t\t\t\t\tonChange={(e) => this._update(\"sound\", it.name)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span>{it.name}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t\t<br />\n\t\t\t\t<br />\n\n\t\t\t\t<section\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"title\">{strings.buffering}</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{config.bufferingOptions.map((it) => (\n\t\t\t\t\t\t\t<label key={it.name}>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\n\t\t\t\t\t\t\t\t\tname=\"buffering\"\n\t\t\t\t\t\t\t\t\tchecked={config.options.buffering === it.name}\n\t\t\t\t\t\t\t\t\tonChange={() => this._update(\"buffering\", it.name)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span>{it.name}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t\t<br />\n\t\t\t\t<br />\n\n\t\t\t\t<section\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"title\">{strings.crtEffect}</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{[true, false].map((it) => (\n\t\t\t\t\t\t\t<label key={it}>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\t\tclassName=\"nes-radio is-dark\"\n\t\t\t\t\t\t\t\t\tname=\"crt\"\n\t\t\t\t\t\t\t\t\tchecked={config.options.crt === it}\n\t\t\t\t\t\t\t\t\tonChange={() => this._update(\"crt\", it)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span>{strings[`enabled_${it}`]}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</section>\n\t\t\t\t<br />\n\t\t\t\t<br />\n\n\t\t\t\t<section\n\t\t\t\t\tclassName={classNames(\"nes-container\", \"is-dark\", \"with-title\")}\n\t\t\t\t>\n\t\t\t\t\t<div className=\"title\">{strings.input}</div>\n\n\t\t\t\t\t{BUTTONS.map((button) => (\n\t\t\t\t\t\t<KeyBinding\n\t\t\t\t\t\t\tkey={button.name}\n\t\t\t\t\t\t\tname={button.name}\n\t\t\t\t\t\t\tverticalMirror={button.verticalMirror}\n\t\t\t\t\t\t\tdisplayName={button.displayName}\n\t\t\t\t\t\t\tisAssigning={this.state.mappingButton === button.name}\n\t\t\t\t\t\t\tonAssignStart={() =>\n\t\t\t\t\t\t\t\tthis.setState({ mappingButton: button.name })\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonAssignCancel={() => this.setState({ mappingButton: null })}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</section>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t_update(property, value) {\n\t\t_.set(config.options, property, value);\n\t\tconfig.save();\n\t\tthis._notify();\n\t}\n\n\t_notify() {\n\t\tbus.emit(\"volume\", config.sound.gain);\n\t\tbus.emit(\"keymap\");\n\n\t\tconst container = document.querySelector(\"#container\");\n\t\tif (config.options.crt) container.classList.add(\"crt\");\n\t\telse container.classList.remove(\"crt\");\n\n\t\tthis.forceUpdate();\n\t}\n\n\t_onClose = () => {\n\t\tbus.emit(\"closeSettings\");\n\t};\n\n\t_onSetDefaults = () => {\n\t\tconfig.reset();\n\t\tthis._notify();\n\t};\n\n\t_onAssign = () => {\n\t\tif (this.props.isAssigning) return;\n\n\t\tthis.props.onAssignStart();\n\t\twindow.addEventListener(\"keydown\", this._onKeyDown);\n\t};\n\n\t_onKeyDown = (e) => {\n\t\tif (!this.state.mappingButton) return;\n\n\t\te.preventDefault();\n\n\t\tconst oldKey = _.findKey(\n\t\t\tconfig.options.input,\n\t\t\t(it) => it === this.state.mappingButton\n\t\t);\n\t\tconst newKey = e.key;\n\n\t\tdelete config.options.input[oldKey];\n\t\tconfig.options.input[newKey] = this.state.mappingButton;\n\t\tconfig.save();\n\t\tthis._notify();\n\n\t\tthis.setState({ mappingButton: null });\n\t};\n}\n","import React, { Component } from \"react\";\r\nimport Loader from \"react-loader-spinner\";\r\nimport Settings from \"./Settings\";\r\nimport bus from \"../events\";\r\nimport styles from \"./Overlay.module.css\";\r\nimport classNames from \"classnames\";\r\n\r\nexport default class Overlay extends Component {\r\n\tstate = { isSettingsMenuOpen: false, isLoading: false, message: null };\r\n\r\n\trender() {\r\n\t\tconst { isVisible } = this;\r\n\t\tconst { isSettingsMenuOpen, isLoading, message } = this.state;\r\n\r\n\t\treturn (\r\n\t\t\t<div className={classNames(styles.overlay, isVisible && styles.show)}>\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={classNames(styles.loader, message == null && styles.dark)}\r\n\t\t\t\t>\r\n\t\t\t\t\t{isSettingsMenuOpen ? (\r\n\t\t\t\t\t\t<Settings />\r\n\t\t\t\t\t) : message != null ? (\r\n\t\t\t\t\t\t<div className={styles.message}>{message}</div>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\tisLoading && (\r\n\t\t\t\t\t\t\t<Loader type=\"Watch\" color=\"#CCCCCC\" height=\"50\" width=\"50\" />\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tbus\r\n\t\t\t.on(\"isLoading\", (isLoading) => {\r\n\t\t\t\tthis.setState({ isLoading });\r\n\t\t\t})\r\n\t\t\t.on(\"message\", (message) => {\r\n\t\t\t\tthis.setState({ isLoading: false, message });\r\n\t\t\t})\r\n\t\t\t.on(\"openSettings\", () => {\r\n\t\t\t\tthis.setState({ isSettingsMenuOpen: true });\r\n\t\t\t})\r\n\t\t\t.on(\"closeSettings\", () => {\r\n\t\t\t\tthis.setState({ isSettingsMenuOpen: false });\r\n\t\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tbus.removeListener(\"isLoading\");\r\n\t\tbus.removeListener(\"message\");\r\n\t\tbus.removeListener(\"openSettings\");\r\n\t\tbus.removeListener(\"closeSettings\");\r\n\t}\r\n\r\n\tget isVisible() {\r\n\t\treturn (\r\n\t\t\tthis.state.isSettingsMenuOpen ||\r\n\t\t\tthis.state.isLoading ||\r\n\t\t\tthis.state.message != null\r\n\t\t);\r\n\t}\r\n}\r\n","import React, { Component } from \"react\";\n\nconst SCREEN_WIDTH = 256;\nconst SCREEN_HEIGHT = 240;\n\nexport default class TVNoise extends Component {\n\trender() {\n\t\treturn (\n\t\t\t<canvas\n\t\t\t\tstyle={{ width: \"100%\", height: \"100%\", borderRadius: 8 }}\n\t\t\t\twidth={SCREEN_WIDTH}\n\t\t\t\theight={SCREEN_HEIGHT}\n\t\t\t\tref={(canvas) => {\n\t\t\t\t\tif (canvas) this._initCanvas(canvas);\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tcancelAnimationFrame(this._frameId);\n\t}\n\n\t_initCanvas(canvas) {\n\t\tconst self = this;\n\t\tconst context = canvas.getContext(\"2d\");\n\n\t\tfunction noise(ctx) {\n\t\t\tlet w = ctx.canvas.width,\n\t\t\t\th = ctx.canvas.height,\n\t\t\t\tidata = ctx.createImageData(w, h),\n\t\t\t\tbuffer32 = new Uint32Array(idata.data.buffer),\n\t\t\t\tlen = buffer32.length,\n\t\t\t\ti = 0;\n\n\t\t\tfor (; i < len; ) buffer32[i++] = ((255 * Math.random()) | 0) << 24;\n\n\t\t\tctx.putImageData(idata, 0, 0);\n\t\t}\n\n\t\tlet toggle = true;\n\t\t(function loop() {\n\t\t\ttoggle = !toggle;\n\t\t\tif (toggle) {\n\t\t\t\tself._frameId = requestAnimationFrame(loop);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tnoise(context);\n\t\t\tself._frameId = requestAnimationFrame(loop);\n\t\t})();\n\t}\n}\n","import cleanQueryString from \"./cleanQueryString\";\nimport ellipsize from \"./ellipsize\";\n\nexport default { cleanQueryString, ellipsize };\n","export default () => {\n\tlet url;\n\turl = window.location.href;\n\turl = url.replace(url.substring(url.indexOf(\"?\")), \"\");\n\turl = url.substring(url.indexOf(\"//\") + 2);\n\turl = url.substring(url.indexOf(\"/\"));\n\twindow.history.replaceState({}, \"\", url);\n};\n","export default (string, limit) =>\n\t`${string.substring(0, limit)}${string.length > limit ? \"…\" : \"\"}`;\n","import React, { Component } from \"react\";\nimport config from \"../config\";\nimport strings from \"../locales\";\nimport helpers from \"../gui/helpers\";\nimport bus from \"../events\";\nimport styles from \"./Controls.module.css\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\n\nconst TRICK_TIME = 100;\nconst FRIENDLY_NAMES = {\n\tArrowLeft: \"<\",\n\tArrowRight: \">\",\n\tArrowUp: \"~v\",\n\tArrowDown: \"v\",\n\t\" \": \"[Space]\"\n};\n\nexport default class Controls extends Component {\n\trender() {\n\t\tconst upKey = this._keyFor(\"BUTTON_UP\");\n\t\tconst isUpArrow = upKey === \"~v\";\n\n\t\treturn (\n\t\t\t<div className={styles.controls} id=\"controls\">\n\t\t\t\t<b className={classNames(styles.title, styles.centered)}>\n\t\t\t\t\t{strings.controls}\n\t\t\t\t</b>\n\t\t\t\t<br />\n\t\t\t\t<div className={styles.controller}>\n\t\t\t\t\t<span className={styles.dpad}>\n\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_LEFT\")}</span>{\" \"}\n\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_RIGHT\")}</span>{\" \"}\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tstyle={\n\t\t\t\t\t\t\t\tisUpArrow\n\t\t\t\t\t\t\t\t\t? { transform: \"scale(1, -1)\", display: \"inline-block\" }\n\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{isUpArrow ? \"v\" : upKey}\n\t\t\t\t\t\t</span>{\" \"}\n\t\t\t\t\t\t<span>{this._keyFor(\"BUTTON_DOWN\")}</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span className={styles.buttons}>\n\t\t\t\t\t\t{this._keyFor(\"BUTTON_B\")} {this._keyFor(\"BUTTON_A\")}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div className={styles.centered}>\n\t\t\t\t\t{this._keyFor(\"BUTTON_SELECT\")} {this._keyFor(\"BUTTON_START\")}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tbus.on(\"keymap\", () => {\n\t\t\tbus.emit(\"keymap-updated\");\n\t\t\tthis.forceUpdate();\n\n\t\t\tconst element = document.querySelector(\"#controls\");\n\t\t\telement.classList.remove(\"blink\");\n\t\t\tsetTimeout(() => element.classList.add(\"blink\"), TRICK_TIME);\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\tbus.removeListener(\"keymap\");\n\t}\n\n\t_keyFor(button) {\n\t\tconst key = _.findKey(config.options.input, (it) => it === button);\n\t\tif (!key) return \"[?]\";\n\n\t\treturn this._format(key);\n\t}\n\n\t_format(key) {\n\t\treturn (\n\t\t\tFRIENDLY_NAMES[key] ||\n\t\t\t(key.length === 1 ? key.toUpperCase() : `[${helpers.ellipsize(key, 6)}]`)\n\t\t);\n\t}\n}\n","import React, { Component } from \"react\";\r\nimport bus from \"../events\";\r\nimport styles from \"./SettingsButton.module.css\";\r\nimport strings from \"../locales\";\r\n\r\nexport default class SettingsButton extends Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className={styles.button}>\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\ttabIndex=\"-1\"\r\n\t\t\t\t\tclassName=\"nes-btn\"\r\n\t\t\t\t\tonClick={this._onClick}\r\n\t\t\t\t>\r\n\t\t\t\t\t{strings.settings}\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t_onClick = () => {\r\n\t\tbus.emit(\"openSettings\");\r\n\t};\r\n}\r\n","import React, { Component } from \"react\";\nimport Emulator from \"../emulator\";\nimport InviteHeader from \"./InviteHeader\";\nimport JoinHeader from \"./JoinHeader\";\nimport Overlay from \"./Overlay\";\nimport Header from \"../widgets/Header\";\nimport TVNoise from \"../widgets/TVNoise\";\nimport Controls from \"../widgets/Controls\";\nimport SettingsButton from \"../widgets/SettingsButton\";\nimport helpers from \"./helpers\";\nimport config from \"../config\";\nimport bus from \"../events\";\nimport styles from \"./PlayScreen.module.css\";\nimport strings from \"../locales\";\nimport classNames from \"classnames\";\nimport _ from \"lodash\";\n\n// DEBUG\nwindow.bus = require(\"../events\").default;\nwindow.config = require(\"../config\").default;\n\nexport default class PlayScreen extends Component {\n\tstate = { rom: null, syncer: null };\n\n\trender() {\n\t\tconst { token } = this.props;\n\t\tconst { rom, syncer } = this.state;\n\n\t\treturn (\n\t\t\t<div className={styles.app}>\n\t\t\t\t{syncer ? (\n\t\t\t\t\t<Header>{strings.connected}</Header>\n\t\t\t\t) : token ? (\n\t\t\t\t\t<JoinHeader\n\t\t\t\t\t\tonSyncer={this._onSyncer}\n\t\t\t\t\t\tonError={this._onError}\n\t\t\t\t\t\ttoken={token}\n\t\t\t\t\t/>\n\t\t\t\t) : (\n\t\t\t\t\t<InviteHeader\n\t\t\t\t\t\tonSyncer={this._onSyncer}\n\t\t\t\t\t\tonError={this._onError}\n\t\t\t\t\t\tneedsRom={!rom}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\n\t\t\t\t{\n\t\t\t\t\t<div className={styles.main}>\n\t\t\t\t\t\t<section\n\t\t\t\t\t\t\tclassName={classNames(\n\t\t\t\t\t\t\t\tstyles.gameContainer,\n\t\t\t\t\t\t\t\t\"nes-container\",\n\t\t\t\t\t\t\t\t\"is-dark\",\n\t\t\t\t\t\t\t\t\"with-title\"\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div className={styles.overlay}>\n\t\t\t\t\t\t\t\t<Overlay />\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{rom ? (\n\t\t\t\t\t\t\t\t<Emulator\n\t\t\t\t\t\t\t\t\trom={rom}\n\t\t\t\t\t\t\t\t\tsyncer={syncer}\n\t\t\t\t\t\t\t\t\tonStartPressed={this._onStartPressed}\n\t\t\t\t\t\t\t\t\tonError={this._onError}\n\t\t\t\t\t\t\t\t\tref={(ref) => (this.emulator = ref)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<TVNoise />\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</section>\n\t\t\t\t\t</div>\n\t\t\t\t}\n\n\t\t\t\t<div className={styles.controls}>\n\t\t\t\t\t<Controls />\n\t\t\t\t</div>\n\n\t\t\t\t<div className={styles.menu}>\n\t\t\t\t\t<SettingsButton />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener(\"dragover\", this._ignore);\n\t\twindow.addEventListener(\"dragenter\", this._ignore);\n\t\twindow.addEventListener(\"drop\", this._onFileDrop);\n\t\tif (config.options.crt)\n\t\t\tdocument.querySelector(\"#container\").classList.add(\"crt\");\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"dragover\", this._ignore);\n\t\twindow.removeEventListener(\"dragenter\", this._ignore);\n\t\twindow.removeEventListener(\"drop\", this._onFileDrop);\n\t}\n\n\t_onSyncer = (syncer) => {\n\t\tthis.setState({ syncer });\n\n\t\tsyncer.on(\"rom\", (rom) => {\n\t\t\tthis._loadRom(rom, () => syncer.initializeEmulator(this.emulator), false);\n\t\t});\n\t\tsyncer.on(\"start\", () => this.emulator && this.emulator.start());\n\n\t\tsyncer.initializeRom(this.state.rom);\n\t};\n\n\t_loadRom(rom, callback = _.noop, start = true) {\n\t\tbus.emit(\"message\", null);\n\n\t\tthis.setState({ rom }, () => {\n\t\t\tcallback();\n\t\t\tif (start) this.emulator.start();\n\t\t});\n\t}\n\n\t_onFileDrop = (e) => {\n\t\te.preventDefault();\n\n\t\tconst file = _.first(e.dataTransfer.files);\n\t\tconst reader = new FileReader();\n\t\tif (!file) return;\n\n\t\treader.onload = (event) => {\n\t\t\tconst rom = event.target.result;\n\n\t\t\tif (this.state.syncer) this.state.syncer.updateRom(rom);\n\t\t\telse this._loadRom(event.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t};\n\n\t_ignore = (e) => {\n\t\te.stopPropagation();\n\t\te.preventDefault();\n\t};\n\n\t_onStartPressed = () => {\n\t\tif (!this.state.syncer) return;\n\t\tthis.state.syncer.onStartPressed();\n\t};\n\n\t_onError = (error, reset = true) => {\n\t\tthis.setState({ rom: null });\n\t\tbus.emit(\"message\", error || strings.errors.connectionFailed);\n\t\tif (!reset) return;\n\n\t\tthis.setState({ syncer: null });\n\t\thelpers.cleanQueryString();\n\t\twindow.location.href = \"#/\";\n\t};\n}\n","import React, { PureComponent } from \"react\";\nimport PlayScreen from \"./gui/PlayScreen\";\nimport querystring from \"query-string\";\nimport quickp2p, { SimpleStore } from \"quickp2p\";\n\nquickp2p.setStore(\n\tnew SimpleStore(\"https://simple-key-value-store.herokuapp.com\")\n);\n\nexport default class App extends PureComponent {\n\trender() {\n\t\tconst route = window.location.hash;\n\n\t\tif (route.startsWith(\"#/join\"))\n\t\t\treturn <PlayScreen token={this.inviteToken} />;\n\t\telse return <PlayScreen />;\n\t}\n\n\tcomponentWillMount() {\n\t\tthis._listener = window.addEventListener(\"hashchange\", (e) => {\n\t\t\tthis.forceUpdate();\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener(\"hashchange\", this._listener);\n\t}\n\n\tget inviteToken() {\n\t\treturn querystring.parse(window.location.search).token;\n\t}\n}\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport \"nes.css/css/nes.css\";\r\nimport \"./index.css\";\r\nimport \"./crt.css\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"controls\":\"Controls_controls__1MAwL\",\"title\":\"Controls_title__2gdGP\",\"controller\":\"Controls_controller__3qyQL\",\"dpad\":\"Controls_dpad__tSxB7\",\"buttons\":\"Controls_buttons__1DwlV\",\"centered\":\"Controls_centered__An7X0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"app\":\"PlayScreen_app__1VZYN\",\"main\":\"PlayScreen_main__37CDP\",\"gameContainer\":\"PlayScreen_gameContainer__3EroP\",\"overlay\":\"PlayScreen_overlay__ctMj0\",\"controls\":\"PlayScreen_controls__1GBZi\",\"menu\":\"PlayScreen_menu__2wSDG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"overlay\":\"Overlay_overlay__307fQ\",\"show\":\"Overlay_show__2dh8Q\",\"loader\":\"Overlay_loader__3l-yj\",\"dark\":\"Overlay_dark__3syhT\",\"message\":\"Overlay_message__2ixpA\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"settings\":\"Settings_settings__1wlAR\",\"closeButton\":\"Settings_closeButton__1YJyL\",\"setDefaultsButton\":\"Settings_setDefaultsButton__2nqWX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"balloon\":\"BalloonMessage_balloon__awXbe\",\"character\":\"BalloonMessage_character__1dWHW\"};","import EventEmitter from \"eventemitter3\";\n\nexport default new EventEmitter();\n","import bus from \"./bus\";\n\nexport default bus;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"screen\":\"Screen_screen__2bhWO\"};","module.exports = __webpack_public_path__ + \"static/media/halu.2e5e0dc3.svg\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"button\":\"SettingsButton_button__1HZCJ\"};","const KEY = \"options\";\nconst HALF_VOLUME = \"50%\";\nconst DISABLED = \"Disabled\";\n\nclass Config {\n\tconstructor() {\n\t\tthis.options = this.defaultOptions;\n\t\tthis.load();\n\t}\n\n\tsave() {\n\t\tlocalStorage.setItem(KEY, JSON.stringify(this.options));\n\t}\n\n\tload() {\n\t\ttry {\n\t\t\tthis.options =\n\t\t\t\tJSON.parse(localStorage.getItem(KEY)) || this.defaultOptions;\n\t\t} catch (e) {\n\t\t\tthis.reset();\n\t\t}\n\t}\n\n\treset() {\n\t\tthis.options = this.defaultOptions;\n\t\tthis.save();\n\t}\n\n\tget sound() {\n\t\treturn this.soundOptions.find((it) => it.name === this.options.sound);\n\t}\n\n\tget buffering() {\n\t\treturn this.bufferingOptions.find(\n\t\t\t(it) => it.name === this.options.buffering\n\t\t);\n\t}\n\n\tget defaultOptions() {\n\t\treturn {\n\t\t\tsound: HALF_VOLUME,\n\t\t\tbuffering: DISABLED,\n\t\t\tcrt: true,\n\t\t\tinput: {\n\t\t\t\t\" \": \"BUTTON_A\",\n\t\t\t\td: \"BUTTON_B\",\n\t\t\t\tDelete: \"BUTTON_SELECT\",\n\t\t\t\tEnter: \"BUTTON_START\",\n\t\t\t\tArrowUp: \"BUTTON_UP\",\n\t\t\t\tArrowDown: \"BUTTON_DOWN\",\n\t\t\t\tArrowLeft: \"BUTTON_LEFT\",\n\t\t\t\tArrowRight: \"BUTTON_RIGHT\"\n\t\t\t}\n\t\t};\n\t}\n\n\tget soundOptions() {\n\t\treturn [\n\t\t\t{ name: \"100%\", gain: 1 },\n\t\t\t{ name: \"90%\", gain: 0.9 },\n\t\t\t{ name: \"75%\", gain: 0.75 },\n\t\t\t{ name: HALF_VOLUME, gain: 0.5 },\n\t\t\t{ name: \"25%\", gain: 0.25 },\n\t\t\t{ name: \"10%\", gain: 0.1 },\n\t\t\t{ name: \"0%\", gain: 0 }\n\t\t];\n\t}\n\n\tget bufferingOptions() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tname: DISABLED,\n\t\t\t\tmasterBufferLimit: 3,\n\t\t\t\tminBufferSize: 1,\n\t\t\t\tmaxBufferSize: 1\n\t\t\t},\n\t\t\t{ name: \"Low\", masterBufferLimit: 3, minBufferSize: 1, maxBufferSize: 2 },\n\t\t\t{\n\t\t\t\tname: \"Medium\",\n\t\t\t\tmasterBufferLimit: 5,\n\t\t\t\tminBufferSize: 2,\n\t\t\t\tmaxBufferSize: 3\n\t\t\t},\n\t\t\t{ name: \"High\", masterBufferLimit: 5, minBufferSize: 3, maxBufferSize: 5 }\n\t\t];\n\t}\n}\n\nexport default new Config();\n"],"sourceRoot":""}